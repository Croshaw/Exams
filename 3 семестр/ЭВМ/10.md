[[ЭВМ|<==]]
![[9#Элементы ассемблера процессора intel]]
# Пересылка данных
Под **пересылкой данных** понимаются копирование кода, находящегося в команде пересылки (непосредственный операнд), в регистре процессора или в поле оперативной памяти, и последующая его запись в регистр или поле памяти. Адрес, по которому находится копируемый код, считается **источником**, а адрес, по которому размещается копия, считается **приемником**. Таким образом, источником пересылки могут быть выполняемая команда, регистр или поле памяти, а приемником — только регистр или поле памяти. Это действие следовало назвать бы **копированием**.
Пересылка осуществляется с помощью команды `mov`
Длина пересылаемого кода определяется по следующим правилам. Если операндом команды является 8-битовый регистр (AL, AH, BL, BH и т. д.), то пересылается 1 байт, если операнд — это 16-битовый регистр (AX, BX, и т. д.), то пересылается 2 байта. Если в операции пересылки регистры процессора не участвуют, то во внимание принимается длина поля памяти, которая задается в директиве определения данных. В тех ситуациях, когда и эта возможность определения длины отсутствует, программист должен включить в команду дополнительный параметр `byte ptr` или `word ptr`. Операнды команды пересылки не должны диктовать противоречивые требования к длине пересылаемого кода. Так, например, в команде не могут одновременно использоваться 8-битовый и 16-битовый регистры.
Затрагиваются при пересылки флаги [[1#Регистры|SF и ZF]]
На пересылку данных с помощью команды mov накладываются следующие ограничения:
- запрещается прямая пересылка из одного поля памяти в другое;
- запрещается использование в качестве приемника регистра CS;
- нельзя загрузить код в сегментный регистр из поля памяти;
- нельзя переслать код из одного сегментного регистра в другой.
# Работа со стеком
Стеком называется динамическая структура данных, организованная на базе связного списка, у которого для включения и исключения новых элементов доступен только один конец. Стек обслуживается по принципу LIFO (от Last In First Out — последний включенный исключается первым). Доступный конец стека, через который объект поступает в стек или выбирается из него, принято называть **вершиной стека**. Основными операциями над стеком являются создание пустого стека, проверка стека на пустоту, а также включение в вершину стека нового объекта и выборка объекта из стека.
Для реализации стека программист может использовать сегмент стека оперативной памяти и соответствующий программный сегмент. Как уже упоминалось, адрес сегмента стека выбирается из регистра ss, а внутрисегментное смещение вершины стека — из регистра **SP**. Таким образом, пара **ss**:**SP** содержит полный указатель на вершину стека, то есть на код, занесенный в стек последним. Элементами программного стека являются машинные слова, то есть двухбайтовые коды.
При записи в стек списка формальных параметров подпрограммы смещение начального байта этого списка сохраняется в регистре **BP**. Таким образом, пара регистров **SS**:**BP** содержит указатель на начало списка фактических параметров. Область стека между указателями **SS**:**BP** и **SS**:**SP**, которая содержит весь список параметров, называют **кадром стека**. В связи с этим регистр **BP**, содержащий адрес, от которого начинается кадр, называют **указателем базы стека** или **указателем кадра стека**. Смещение из этого регистра можно использовать для доступа к отдельным параметрам подпрограммы.
Для работы со стеком в Ассемблере предусмотрено несколько команд. В частности, для копирования слова из регистра или поля памяти в стек применяется команда `push`, а для удаления слова из стека и последующего его размещения в регистре процессора или в поле памяти команда `рор`. Обе команды имеют один операнд, который может быть регистром процессора или полем оперативной памяти. В команде `push` операнд указывает адрес кода, который должен быть записан в стек, а в команде `рор` адрес приемника кода, выбранного из его вершины.
Важной особенностью выполнения работающих со стеком команд является уменьшение содержимого регистра **SP** при включении кода в стек. Это означает, что вершина стека растет в сторону уменьшения адресов оперативной памяти. И наоборот, при выборке из стека содержимое **SP** увеличивается.
По принятым в операционной системе правилам требуется, чтобы любая программа в самом начале своего выполнения:
- сохранила в стеке содержимое сегментного регистра **DS** (команда `push ds`);
- в следующее слово стека занесла нулевой код (команды `sub ах, ах` и `push ах`);
- занесла в регистр **DS** адрес сегмента данных программы, соответствующий метке этого сегмента (команды `mov ах, dtseg` и `mov ds, ах`, здесь предполагается, что dtseg — метка директив, ограничивающих сегмент данных).