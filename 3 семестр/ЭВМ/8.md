[[ЭВМ|<==]]
# Прерывания
Нужна детально проработанная схема взаимодействия между процессором и внешними устройствами во время обмена в целом.
Здесь речь идет не об обмене данными между процессором и внешними устройствами, а о взаимодействии между процессором и внешними устройствами во время обмена.
Теоретически возможны два способа такого взаимодействия: **опрос** и **прерывание**. Опрос представляет собой периодическое прекращение текущей работы процессора и посылку им запросов каждому из внешних устройств на возможность или необходимость выполнения операции по обмену. Очевидным недостатком такого способа взаимодействия является то, что процессор подавляющую часть времени будет заниматься не обработкой данных, а выяснением наличия у внешних устройств вопросов.
Поэтому в компьютере обмен данными организован с помощью прерываний, одним из важнейших элементов которых является запрос на выполнение операции обмена, посылаемый процессору со стороны внешних устройств или же выполняющейся программы.
Под прерыванием понимается прекращение выполнения одной программы и переключение процессора на выполнение другой программы. При необходимости выполнение прерванной программы может быть возобновлено.
Физически прерывание организуется с помощью сигнала 1КО (от Interrupt ReQuest — запрос прерывания), поступающего в процессор от одного из устройств компьютера. С его помощью устройство извещает процессор о том, что для дальнейшего выполнения обмена ему требуются некоторые действия процессора. Получив такой сигнал, процессор запоминает свое текущее состояние и всю необходимую для возобновления работы информацию, а затем переключается на выполнение специальной программы, которая называется программой обработки прерывания. В процессе ее выполнения устройство передает процессору некоторую дополнительную информацию о создавшейся во время выполнения обмена ситуации. Обычно эта информация представлена в виде так называемого кода завершения (функции завершения), специфического для каждого из устройств, выполняющих обмен. Код завершения показывает, правильно или неправильно, полностью или не полностью завершился обмен, требуется ли вмешательство пользователя для дальнейшего его выполнения (например, в случае отсутствия бумаги в принтере) и т. д. Код завершения может также показывать, что запрошенные действия устройство выполнить не в состоянии. В соответствии с полученной в коде завершения информацией процессор должным образом организует дальнейшую обработку прерывания. Затем он может вернуться к выполнению ранее прерванной программы.
# Классификация
Различают классы **внешних** и **внутренних** прерываний. Внешние прерывания происходят от внешних по отношению к процессору устройств. К ним относятся **прерывания** **ввода**/**вывода**, которые поступают в процессор от устройств, завершивших обмен и требующих в связи с этим определенной реакции процессора, а также аппаратные прерывания, поступающие в процессор от различных устройств компьютера в случае обнаружения сбоев в их работе.
Для обеспечения единообразия в обработке различных операций по обмену и возникающих при этом ситуаций введен класс внутренних прерываний, которые происходят внутри самого процессора. К ним относятся программные прерывания и прерывания от исключительной ситуации. Программными прерываниями считаются, например, запросы со стороны программы на начало выполнения ввода иди вывода. Программные прерывания выполняются с помощью включения в программу команды `int n` (КОП = 1100110,), где n — номер прерывания. Исключительные ситуации возникают в тех случаях, когда процессор не в состоянии выполнить предусмотренное в программе действие, например деление на нуль. В этом случае он прерывает выполнение программы и сообщает инструментальной среде или операционной системе о наличии исключительной ситуации, а также выдает необходимую дополнительную информацию, которая позволяет более точно определить причину ее возникновения.
# Типы
Дополнительная информация о характере прерывания передается по шине данных в процессор в виде целочисленного кода n, 0 < n < 255, который называется типом, или номером, прерывания. Следовательно, с помощью номера п могут различаться 256 типов прерываний. Именно этот номер включается в упоминавшуюся ранее команду программного прерывания int n.
Далее представлены некоторые типы прерываний и их номера:
- тип 0 — деление на нуль;
- тип 1 — пошаговая работа (трассировка);
- тип 2 — катастрофическая ситуация, например отключение электропитания;
- тип 3 — прерывание из программы с помощью специальной команды ПМТ;
- тип 4 — переполнение порядка при работе со знаковым операндом;
- тип 5 — выход индекса за границу;
- тип 6 — недействительный код операции и т. д.
# Обработка прерываний
Находящаяся в программе команда ввода или вывода вызывает внутреннее программное прерывание, выполняя которое, процессор инициирует (запускает) указанное в команде устройство. Так как внешние устройства работают очень медленно, к тому же, их работа может зависеть от человека (например, в случае ввода с клавиатуры), выполнение программы, запросившей обмен, приостанавливается, а процессор переключается на выполнение какой-либо другой программы или же переходит в состояние ожидания. Завершив прием или передачу очередного байта (или слова), запущенное процессором устройство извещает об этом процессор с помощью сигнала внешнего прерывания. Если при поступлении сигнала на вход INTR флажок **IF** = 1, то есть прерывание не замаскировано, процессор обязан его обработать. Во время обработки прерывания процессор выполняет следующие действия.
1. Завершает выполнение текущей команды выполняемой программы.
2. Сбрасывает флажок **IF** в состояние 0, запрещая на время обработки текущего прерывания поступление других внешних прерываний.
3. Запоминает в стеке содержимое всех регистров (общего назначения, индексных, базовых).
4. Запоминает в стеке содержимое регистра флажков. 
5. Запоминает в стеке адрес следующей команды выполняемой программы.
6. Запрашивает у внешнего устройства тип прерывания, которое возвращается в процессор по шине данных.
7. Выбирает из таблицы векторов прерываний адрес, соответствующей полученному типу программы обработки прерывания, и загружает его в регистры **CS:IP**.
8. Выполняет программу обработки прерывания, после завершения которой устанавливает флажок **IF** равным 1, разрешая тем самым обработку последующих прерываний.