[[ЭВМ|<==]]
# Улучшение архитектуры процессора
Довольно быстро специалисты обнаружили, что выполнение процессором большинства машинных команд включает в себя практически одинаковые действия. Было бы неразумно для каждой машинной команды предусматривать отдельные аппаратные схемы выполнения, в которых дублируются выполняемые по общим правилам действия.
В связи с этим еще в 1951 г. М. Уилкс из Кембриджского университета с целью упрощения аппаратного обеспечения компьютера предложил подход, который впоследствии получил название **микропрограммирования**. Для его реализации в структурную организацию вычислительной системы между цифровым логическим уровнем и уровнем машинных команд включается дополнительный **микроархитектурный** уровень.
Основу микроархитектурного уровня образуют **микрокоманды**. Каждая микрокоманда, выдавая управляющие сигналы на отдельные вентили аппаратных схем, определяет некоторое простейшее действие процессора, например задает выбор кода из конкретного регистра процессора, установку флажка в соответствующее результату значение и т. д. Поэтому выполнение любой машинной команды фактически представляет собой выполнение соответствующей последовательности микрокоманд. Например, команда `add ах, сх` может быть реализована как последовательность микрокоманд, изложенная ниже. 
1. Микрокоманда, выбирающая операнд из регистра **AX** и перемещающая его в арифметико-логическое устройство(АЛУ).
2. Микрокоманда, выбирающая операнд из регистра **CX** и перемещающая его в арифметико-логическое устройство.
3. Микрокоманда, формирующая новое значение указателя команд.
4. Микрокоманда, выполняющая сложение двух операндов.
5. Микрокоманда, отправляющая полученную сумму в регистр **AX**.
6. Микрокоманда, формирующая значения флажков **ZF** и **SF**.
Если же, например, нужно выполнить команду sub ах, сх, то для ее реализации может быть использована почти такая же последовательность микрокоманд.
Из приведенных примеров видно, что введение микроархитектурного уровня значительно упрощает разработку аппаратных средств, которые теперь должны уметь выполнять значительно меньше различных действий, чем при аппаратной реализации каждой машинной команды в отдельности.
С точки зрения микроархитектурного уровня отдельная машинная команда — это целая программа. Она выполняется либо специальной программой, которую принято называть **микропрограммой**, либо аппаратными средствами процессора. Основными функциями микропрограммы являются построение для каждой машинной команды из программы пользователя соответствующей последовательности микрокоманд и организация их выполнения. Эти действия выполняются микропрограммой для каждой машинной команды по отдельности, то есть программа пользователя фактически интерпретируется микропрограммой, поэтому микропрограмма считается интерпретатором выполняющейся программы.
Из-за огромного влияния микропрограммы на эффективность работы компьютера в целом она разрабатывается особенно тщательно. Обычно микропрограмма имеет небольшие размеры и хранится в постоянном запоминающем устройстве компьютера в виде, недоступном для внесения изменений.
С течением времени границы между функциями микропрограммы и аппаратной реализацией микрокоманд меняются. Появление новых аппаратных возможностей приводит к переносу операций, закрепленных за программным обеспечением, на аппаратный уровень, их встраиванию в аппаратные средства. Это приводит к увеличению скорости выполнения машинных команд.
# Конвейерная архитектура процессора

![[Pasted image 20240109003703.png]]
Рисунок 1 — Стандартное выполнение команд процессором

Группа блоков процессора, обеспечивающих одновременное выполнение различных этапов различных машинных команд, называется **конвейером**, блоки, из которых он состоит, называются **ступенями конвейера**, а количество ступеней -- **длиной конвейера.** Архитектура компьютера, в конструкции процессора которого используется конвейер, называется **конвейерной**.

![[Pasted image 20240109003805.png]]
Рисунок 2 — Пятиступенчатый конвейер выполнение команд процессором

Так как конвейерная архитектура на практике показала свою высокую эффективность, появились различные варианты ее дальнейшего развития. В частности, в процессор стали включать несколько конвейеров, которые могут функционировать одновременно.

Общий для двух конвейеров блок выборки извлекает из буфера (из кэша или из оперативной памяти) сразу две команды и помещает каждую из них на отдельный конвейер. Чтобы не задерживать остальные блоки конвейеров, пропускная способность блока выборки должна обеспечивать выполнение им своих «обязанностей» с соответствующей скоростью.

![[Pasted image 20240109004113.png]]
Рисунок 3 — Архитектура процессора с двумя конвейерами

Архитектура компьютера, процессор которого содержит несколько конвейеров выполнения машинных команд, называется суперконвейерной.
Находящиеся на разных конвейерах команды не должны конфликтовать друг с другом за одни и те же ресурсы, например, использовать одни те же регистры процессора, одни и те же адреса памяти, операнды и т. д. Кроме того, они не должны зависеть друг от друга, то есть результаты выполнения одной из них не должны использоваться как операнды другой. За этим должны следить специальные аппаратные схемы или программное обеспечение, например, специализированные трансляторы, учитывающие особенности архитектуры компьютера.
Из-за необходимости выполнения дополнительных проверок процессоры компьютеров различных моделей содержат только два-три конвейера. Дальнейшее увеличение количества конвейеров вызывает непропорциональное усложнение аппаратных схем и программных средств, разрешающих конфликты и распознающих возможности параллельного выполнения команд программы. Кроме того, из-за значительных временных затрат на эти проверки эффект от организации большого количества конвейеров, фактически, не приводит к увеличению производительности процессора.
# Суперскалярная архитектура процессора
Анализ работы конвейера выявил, что самым критическим с точки зрения временных затрат является этап выполнения заданного в команде действия (сложения, умножения и т. д.). Остальные блоки конвейера зачастую вынуждены простаивать в ожидании его завершения. Для устранения простоев конвейера в это «узкое» место включили несколько **исполнительных** блоков (арифметико-логических устройств, сопроцессоров и т. д.), которые могут одновременно выполнять закодированные в машинных командах действия. Такой подход был назван **суперскалярной архитектурой**.
Архитектура, в которой используется большое количество параллельно работающих на этапе исполнения действия команды блоков, называется суперскалярной.

![[Pasted image 20240109004451.png]]
Рисунок 4 — Суперскалярная архитектура процессора

В дальнейшем появились процессоры, которые объединяют оба подхода к архитектуре процессора. Такие процессоры считаются суперскалярными суперконвейерными.